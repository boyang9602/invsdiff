package ca.concordia.apr.invsdiff;

import java.io.FileNotFoundException;
import java.io.IOException;

import ca.concordia.apr.invsdiff.diff.Diff;
import ca.concordia.apr.invsdiff.diff.DiffByType;

/**
 * Compare similar invariants file generated by daikon, i.e. invariants of slightly different versions
 *
 */
public class App 
{
    public static void main( String[] args ) throws FileNotFoundException, IOException
    {
    	if (args.length < 2) {
    		System.out.println("Usage: \nca.concordia.apr.invsdiff.App [options] invsfile0 invsfile1 invsfile2 ... \noptions: \n\t--multiple generate multiple diff files by name");
    		System.exit(1);
    	}
    	InvsFile base = null;
    	boolean multiple = false;
        for (int j = 0; j < args.length; j++) {
        	if (args[j].startsWith("--")) {
        		multiple |= args[j].equals("--multiple");
        	} else {
        		if (base == null) {
        			base = new InvsFile(args[j]);
        		} else {
                	InvsFile toBeCompared = new InvsFile(args[j]);
                	if (multiple) {
                		DiffByType diff = new DiffByType(base, toBeCompared);
                		diff.execute();
                    	diff.writeJSONTo("diffByType-" + base.getFilename() + "-" + toBeCompared.getFilename());
                	} else {
                    	Diff diff = Diff.compare(base, toBeCompared);
                    	diff.writeJSONTo("diff-" + base.getFilename() + "-" + toBeCompared.getFilename() + ".json");
                	}
        		}
        	}
        }
    }
}
